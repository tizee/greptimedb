<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `plan_rewrite` mod in crate `query`."><title>query::range_select::plan_rewrite - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-2c208a72533b4dd0.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="query" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0-nightly (becebb315 2024-04-17)" data-channel="nightly" data-search-js="search-ffac13a0df2b1870.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-e32f0c247825364d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-79b348b11ac95225.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../query/index.html">query</a><span class="version">0.7.2</span></h2></div><h2 class="location"><a href="#">Module plan_rewrite</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In query::range_select</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../../query/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type â€˜Sâ€™ or â€˜/â€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" tabindex="-1"><a href="../../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">query</a>::<wbr><a href="../index.html">range_select</a>::<wbr><a class="mod" href="#">plan_rewrite</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/query/range_select/plan_rewrite.rs.html#15-805">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.inconsistent_check.html" title="macro query::range_select::plan_rewrite::inconsistent_check">inconsistent_check</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.RangeExprRewriter.html" title="struct query::range_select::plan_rewrite::RangeExprRewriter">RangeExprRewriter</a></div><div class="desc docblock-short"><code>RangeExprRewriter</code> will recursively search certain <code>Expr</code>, find all <code>range_fn</code> scalar udf contained in <code>Expr</code>,
and collect the information required by the RangeSelect query,
and finally modify the <code>range_fn</code> scalar udf to an ordinary column field.</div></li><li><div class="item-name"><a class="struct" href="struct.RangePlanRewriter.html" title="struct query::range_select::plan_rewrite::RangePlanRewriter">RangePlanRewriter</a></div><div class="desc docblock-short">In order to implement RangeSelect query like <code>avg(field_0) RANGE '5m' FILL NULL</code>,
All RangeSelect query items are converted into udf scalar function in sql parse stage, with format like <code>range_fn(avg(field_0), .....)</code>.
<code>range_fn</code> contains all the parameters we need to execute RangeSelect.
In order to correctly execute the query process of range select, we need to modify the query plan generated by datafusion.
We need to recursively find the entire LogicalPlan, and find all <code>range_fn</code> scalar udf contained in the project plan,
collecting info we need to generate RangeSelect Query LogicalPlan and rewrite th original LogicalPlan.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.dispose_parse_error.html" title="fn query::range_select::plan_rewrite::dispose_parse_error">dispose_parse_error</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.have_range_in_exprs.html" title="fn query::range_select::plan_rewrite::have_range_in_exprs">have_range_in_exprs</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.parse_align_to.html" title="fn query::range_select::plan_rewrite::parse_align_to">parse_align_to</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Parse the <code>align to</code> clause and return a UTC timestamp with unit of millisecond,
which is used as the basis for dividing time slot during the align operation.</div></li><li><div class="item-name"><a class="fn" href="fn.parse_duration_expr.html" title="fn query::range_select::plan_rewrite::parse_duration_expr">parse_duration_expr</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Parse a duraion expr:</div></li><li><div class="item-name"><a class="fn" href="fn.parse_expr_list.html" title="fn query::range_select::plan_rewrite::parse_expr_list">parse_expr_list</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.parse_expr_to_string.html" title="fn query::range_select::plan_rewrite::parse_expr_to_string">parse_expr_to_string</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.parse_str_expr.html" title="fn query::range_select::plan_rewrite::parse_str_expr">parse_str_expr</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li></ul></section></div></main></body></html>